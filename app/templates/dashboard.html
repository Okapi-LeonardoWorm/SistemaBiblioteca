{% extends 'base.html' %}

{% block title %}Dashboard Administrativo{% endblock %}

{% block head_links %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <header class="dashboard-header mb-4">
        <h2>Dashboard Administrativo</h2>
        <nav class="nav">
            <a class="nav-link text-white" href="{{ url_for('livros') }}">Livros</a>
            <a class="nav-link text-white" href="{{ url_for('emprestimos') }}">Empréstimos</a>
            <a class="nav-link text-white" href="{{ url_for('list_users') }}">Usuários</a>
            <a class="nav-link text-white" href="{{ url_for('palavras_chave') }}">Tags</a>
        </nav>
    </header>

    <!-- KPIs -->
    <div class="row">
        <div class="col-md-3 col-sm-6">
            <div class="kpi-card">
                <div class="kpi-value">{{ total_books }}</div>
                <div class="kpi-label">Livros na Biblioteca</div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6">
            <div class="kpi-card">
                <div class="kpi-value">{{ total_loans_active }}</div>
                <div class="kpi-label">Livros Emprestados</div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6">
            <div class="kpi-card">
                <div class="kpi-value">{{ total_students }}</div>
                <div class="kpi-label">Alunos Cadastrados</div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6">
            <div class="kpi-card">
                <div class="kpi-value">{{ total_staff }}</div>
                <div class="kpi-label">Funcionários</div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Loan List -->
        <div class="col-lg-8">
            <h3 class="section-title">Empréstimos com Devolução Próxima</h3>
            <div class="filter-buttons btn-group mb-3">
                <a href="{{ url_for('dashboard', filter='today') }}" class="btn btn-outline-primary {% if loan_filter == 'today' %}active{% endif %}">Hoje</a>
                <a href="{{ url_for('dashboard', filter='week') }}" class="btn btn-outline-primary {% if loan_filter == 'week' %}active{% endif %}">Esta Semana</a>
                <a href="{{ url_for('dashboard', filter='all') }}" class="btn btn-outline-primary {% if loan_filter == 'all' %}active{% endif %}">Todos</a>
                <a href="{{ url_for('dashboard', filter='overdue') }}" class="btn btn-outline-danger position-relative {% if loan_filter == 'overdue' %}active{% endif %}">
                    Atrasados
                    {% if overdue_loans_count > 0 %}
                        <span class="overdue-badge">{{ overdue_loans_count }}</span>
                    {% endif %}
                </a>
            </div>
            
            <ul class="list-group">
                {% for loan in loans.items %}
                    <a href="{{ url_for('editar_emprestimo', id=loan.LoanId) }}" class="list-group-item list-group-item-action">
                        <strong>Livro:</strong> {{ loan.book.bookName }} | <strong>Usuário:</strong> {{ loan.user.username }} | <strong>Devolução:</strong> {{ loan.returnDate.strftime('%d/%m/%Y') }}
                    </a>
                {% else %}
                    <li class="list-group-item">Nenhum empréstimo encontrado para este filtro.</li>
                {% endfor %}
            </ul>
            <!-- Pagination for loans -->
            {{ render_pagination(loans) }}
        </div>

        <!-- Recently Loaned Books -->
        <div class="col-lg-4">
            <h3 class="section-title">Últimos Livros Emprestados</h3>
            <ul class="list-group">
                {% for info in recent_books %}
                    <li class="list-group-item">
                        {{ info.book.bookName }}
                        <span class="badge bg-secondary float-end">Disponíveis: {{ info.available }}</span>
                    </li>
                {% else %}
                    <li class="list-group-item">Nenhum livro emprestado recentemente.</li>
                {% endfor %}
            </ul>
            <!-- Pagination for recent books -->
            {{ render_pagination(recent_books_pagination, 'recent_books_page') }}
        </div>
    </div>

</div>
{% endblock %}
